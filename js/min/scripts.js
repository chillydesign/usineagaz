function getAccessToken(){hasLocalStorage()&&(localStorage.removeItem("usine_access_token"),localStorage.removeItem("usine_events")),$.ajax({url:access_token_url,method:"GET",data:{}}).done(function(e){if(e.error)console.log(error.error_description);else{var t=e.access_token;hasLocalStorage()&&localStorage.setItem("usine_access_token",t),callEventsApi(t)}})}function callEventsApi(e){if(hasLocalStorage()&&null!=localStorage.getItem("usine_events")){var t=localStorage.getItem("usine_events");initUsineEvents(JSON.parse(t))}else $.ajax({url:"https://api.intrazik.com/api/v1/programmation",method:"GET",data:{access_token:e,dateTimeDebut:"2017-05-01",dateTimeFin:"2019-12-01"}}).done(function(e){hasLocalStorage()&&localStorage.setItem("usine_events",JSON.stringify(e)),initUsineEvents(e)}).fail(function(e){"invalid_grant"==e.responseJSON.error&&(console.log("invlaidgrant"),getAccessToken())})}function getEventTypeName(e,t){var n=_.find(t,function(t){return t.eventTypeId==e});return void 0!==n&&n.eventTypeLib.fre}function processEvents(e,t){for(var n=_.toArray(e),s=0;s<e.length;s++){var i=e[s];i.title=i.title.fre,i.subtitle=i.subtitle.fre,i.style=i.style.fre,i.description2=i.description2.fre,i.link1=i.link1.fre,""==i.link1&&(i.link1=!1),i.month=i.dateStart.split("-")[1],i.day=i.dateStart.split("-")[2],i.description_short=jQuery("<p>"+i.description2+"</p>").text().split(" ").slice(0,20).join(" ")+"...",i.category=getEventTypeName(i.eventTypeId,t),i.banner="",void 0!==i.medias.visuel&&(i.banner=i.medias.visuel[0].content_url)}return n}function get_single_event(e,t){return _.find(e,function(e){return e.eventId==t})}function hasLocalStorage(){var e=window.sessionStorage;try{return e.setItem("test","1"),e.removeItem("test"),!0}catch(e){return!1}}function initUsineEvents(e){var t=$("#events_template").html(),n=$("#events_container"),s=$("#more_events_template").html(),i=$("#more_events_container"),a=$("#event_single_template").html(),o=$("#event_single_container");console.log("data",e);var r=e.events,l=processEvents(r,e.event_types);if($events_for_prochainement=l.slice(0,3),$more_events=l.splice(3,l.length),n.length>0){var c=_.template(t);n.html(c({events:$events_for_prochainement}))}if(i.length>0){var v=_.template(s);i.html(v({events:$more_events}))}if(window.location.hash)for(var d=window.location.hash.split("&"),u=0;u<d.length;u++){var g=d[u];if(console.log(g),-1!==g.indexOf("e=")){var m=g.split("=")[1];if(o.length>0){var f=_.template(a),p=get_single_event(r,m);o.html(f({event:p}))}}}}!function(e,t,n){e(function(){"use strict";var t=e(window),n=(t.height(),e("header")),s=e("#social_bar"),i=e("#featured_section"),a=e("#featured_slides"),o=i.outerHeight();hasLocalStorage()&&null!=localStorage.getItem("usine_access_token")?callEventsApi(localStorage.getItem("usine_access_token")):"undefined "!=typeof access_token_url&&getAccessToken(),setInterval(function(){a.click()},5e3),t.scroll(function(){t.scrollTop()>o?(n.addClass("visible_header"),s.addClass("visible_bar")):(n.removeClass("visible_header"),s.removeClass("visible_bar"))}),e(a).on("click",function(){var t=e("li.visible_slide",a),n=t.next("li");0==n.length&&(n=e("li",a).first()),t.removeClass("visible_slide"),n.addClass("visible_slide")});var r=Math.floor(t.width()/260);e("#partners_slider").bxSlider({minSlides:r,maxSlides:r,slideWidth:260,slideMargin:10,auto:!0,controls:!0,autoControls:!1,pager:!1})})}(jQuery);